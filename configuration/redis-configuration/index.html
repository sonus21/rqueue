<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<link rel="stylesheet" href="/rqueue/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-HWK3PKDELN"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-HWK3PKDELN', { 'anonymize_ip': true }); </script> <script src="/rqueue/assets/js/vendor/lunr.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script src="/rqueue/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/rqueue/static/favicon/favicon.ico" type="image/x-icon">
<title>Redis Configuration | Rqueue</title>
<meta name="generator" content="Jekyll v4.3.2">
<meta property="og:title" content="Redis Configuration">
<meta property="og:locale" content="en_US">
<meta name="description" content="Library for Async Processing using Redis">
<meta property="og:description" content="Library for Async Processing using Redis">
<link rel="canonical" href="https://sonus21.github.io/rqueue/rqueue/configuration/redis-configuration/">
<meta property="og:url" content="https://sonus21.github.io/rqueue/rqueue/configuration/redis-configuration/">
<meta property="og:site_name" content="Rqueue">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Redis Configuration"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Library for Async Processing using Redis","headline":"Redis Configuration","url":"https://sonus21.github.io/rqueue/rqueue/configuration/redis-configuration/"}</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9220054661402722" crossorigin="anonymous"></script>
</head>
<body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title>
<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewbox="0 0 16 16"><title>Copy</title>
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewbox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path> </svg> </symbol> <symbol id="svg-copied" viewbox="0 0 16 16"><title>Copied</title>
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewbox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"></path><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"></path> </svg> </symbol> </svg><div class="side-bar">
<div class="site-header"> <a href="/rqueue/" class="site-title lh-tight"> Rqueue </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a>
</div>
<nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list">
<li class="nav-list-item"><a href="/rqueue/" class="nav-list-link">Home</a></li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander" aria-label="toggle links in Configuration category"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/rqueue/configuration" class="nav-list-link">Configuration</a><ul class="nav-list">
<li class="nav-list-item active"><a href="/rqueue/configuration/redis-configuration/" class="nav-list-link active">Redis Configuration</a></li>
<li class="nav-list-item "><a href="/rqueue/configuration/retry-and-backoff/" class="nav-list-link">Retry and Backoff</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander" aria-label="toggle links in Producer Consumer category"> <svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/rqueue/producer-consumer" class="nav-list-link">Producer Consumer</a><ul class="nav-list">
<li class="nav-list-item "><a href="/rqueue/message-handling" class="nav-list-link">Message Handling</a></li>
<li class="nav-list-item "><a href="/rqueue/message-deduplication" class="nav-list-link">Message Deduplication</a></li>
<li class="nav-list-item "><a href="/rqueue/middleware" class="nav-list-link">Middleware</a></li>
<li class="nav-list-item "><a href="/rqueue/priority" class="nav-list-link">Queue Priority</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="/rqueue/callback-and-events" class="nav-list-link">Callbacks and Events</a></li>
<li class="nav-list-item"><a href="/rqueue/dashboard" class="nav-list-link">Rqueue Dashboard</a></li>
<li class="nav-list-item"><a href="/rqueue/monitoring-alerting" class="nav-list-link">Monitoring and Alerting</a></li>
<li class="nav-list-item"><a href="/rqueue/faq" class="nav-list-link">FAQ</a></li>
<li class="nav-list-item"><a href="/rqueue/CHANGELOG/" class="nav-list-link">CHANGELOG</a></li>
<li class="nav-list-item"><a href="/rqueue/migration" class="nav-list-link">Migration from older to new version</a></li>
</ul>
<ul class="nav-list"><li class="nav-list-item external"> <a href="https://github.com/sonus21/rqueue" class="nav-list-link external"> Rqueue on GitHub <svg viewbox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a>
</li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer>
</div>
<div class="main" id="top">
<div id="main-header" class="main-header">
<div class="search">
<div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Rqueue" aria-label="Search Rqueue" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
</div>
<div id="search-results" class="search-results"></div>
</div>
<nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/sonus21/rqueue" class="site-button"> Rqueue on GitHub </a>
</li></ul></nav>
</div>
<div id="main-content-wrap" class="main-content-wrap">
<nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="/rqueue/configuration">Configuration</a></li>
<li class="breadcrumb-nav-list-item"><span>Redis Configuration</span></li>
</ol></nav><div id="main-content" class="main-content" role="main">
<h1 id="redis-configuration"> <a href="#redis-configuration" class="anchor-heading" aria-labelledby="redis-configuration"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis Configuration</h1>
<p>You can configure your application to use separate Redis connections for Rqueue and other application needs. This approach ensures complete isolation between the Redis connections and their usage, providing distinct environments for storing Rqueue tasks and transient states, as well as other application data.</p>
<p>By configuring separate Redis connections:</p>
<ul>
<li>Rqueue can manage its tasks and transient states in Redis without interference from other application components.</li>
<li>Your main application can utilize a separate Redis connection for its own data storage and retrieval needs.</li>
</ul>
<p>This isolation helps in managing resources efficiently and prevents potential conflicts or performance issues that might arise from shared Redis usage across different parts of your application.</p>
<h2 id="redis-connection-configuration"> <a href="#redis-connection-configuration" class="anchor-heading" aria-labelledby="redis-connection-configuration"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis Connection Configuration</h2>
<p>As an application developer using Rqueue, you have the flexibility to specify which Redis cluster or server should be used for storing Rqueue data. This is achieved by configuring the Redis connection factory via the container factory’s method <code class="language-plaintext highlighter-rouge">setRedisConnectionFactory</code>.</p>
<p>Here’s how you can specify the Redis connection for Rqueue:</p>
<ol>
<li><p>Implement or configure a <code class="language-plaintext highlighter-rouge">RedisConnectionFactory</code> that points to your desired Redis cluster or server.</p></li>
<li><p>Set this connection factory using the <code class="language-plaintext highlighter-rouge">setRedisConnectionFactory</code> method of your Rqueue container factory.</p></li>
</ol>
<p>This approach allows you to control where Rqueue stores its data within Redis, ensuring it aligns with your application’s Redis configuration and deployment requirements.</p>
<p class="warning">When creating a Redis connection factory for Rqueue, it’s essential to set <code class="language-plaintext highlighter-rouge">readFrom</code> to <code class="language-plaintext highlighter-rouge">MASTER_PREFERRED</code>. This ensures that the application starts correctly and operates as expected with the Redis setup.</p>
<h3 id="standalone-redis"> <a href="#standalone-redis" class="anchor-heading" aria-labelledby="standalone-redis"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Standalone Redis</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RqueueConfiguration</span> <span class="o">{</span>
  <span class="c1">// this property must be set to true if you're using webflux or reactive redis</span>
  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${rqueue.reactive.enabled:false}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">reactiveEnabled</span><span class="o">;</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="nf">simpleRqueueListenerContainerFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">LettuceClientConfiguration</span> <span class="n">lettuceClientConfiguration</span> <span class="o">=</span>
        <span class="nc">LettuceClientConfiguration</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">readFrom</span><span class="o">(</span><span class="nc">ReadFrom</span><span class="o">.</span><span class="na">MASTER_PREFERRED</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="c1">// Stand alone redis configuration, Set fields of redis configuration</span>
    <span class="nc">RedisStandaloneConfiguration</span> <span class="n">redisConfiguration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisStandaloneConfiguration</span><span class="o">();</span>
    <span class="c1">// set properties of redis configuration as you need. </span>

    <span class="c1">// Create lettuce connection factory</span>
    <span class="nc">LettuceConnectionFactory</span> <span class="n">redisConnectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisConfiguration</span><span class="o">,</span> <span class="n">lettuceClientConfiguration</span><span class="o">);</span>
    <span class="n">redisConnectionFactory</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>

    <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleRqueueListenerContainerFactory</span><span class="o">();</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setRedisConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">);</span>
    <span class="c1">// if reactive redis is enabled set the correct connection factory</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">reactiveEnabled</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">factory</span><span class="o">.</span><span class="na">setReactiveRedisConnectionFactory</span><span class="o">(</span><span class="n">lettuceConnectionFactory</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// set other properties as you see</span>
    <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="redis-cluster"> <a href="#redis-cluster" class="anchor-heading" aria-labelledby="redis-cluster"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis Cluster</h3>
<p>For Redis clusters, it’s recommended to use the Lettuce client because Jedis does not support <code class="language-plaintext highlighter-rouge">EVALSHA</code> requests, which are often used for efficient script execution in Redis environments.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RqueueConfiguration</span> <span class="o">{</span>
  <span class="c1">// this property must be set to true if you're using webflux or reactive redis</span>
  <span class="nd">@Value</span><span class="o">(</span><span class="s">"${rqueue.reactive.enabled:false}"</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">reactiveEnabled</span><span class="o">;</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="nf">simpleRqueueListenerContainerFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// here always use MASTER_PREFERRED otherwise it will to start</span>
    <span class="nc">LettuceClientConfiguration</span> <span class="n">lettuceClientConfiguration</span> <span class="o">=</span>
        <span class="nc">LettuceClientConfiguration</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">readFrom</span><span class="o">(</span><span class="nc">ReadFrom</span><span class="o">.</span><span class="na">MASTER_PREFERRED</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="c1">// add all nodes</span>
    <span class="nc">RedisClusterConfiguration</span> <span class="n">redisClusterConfiguration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisClusterConfiguration</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">RedisNode</span><span class="o">&gt;</span> <span class="n">redisNodes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="n">redisNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisNode</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9000</span><span class="o">));</span>
    <span class="n">redisNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisNode</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9001</span><span class="o">));</span>
    <span class="n">redisNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisNode</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9002</span><span class="o">));</span>
    <span class="n">redisNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisNode</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9003</span><span class="o">));</span>
    <span class="n">redisNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisNode</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9004</span><span class="o">));</span>
    <span class="n">redisNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">RedisNode</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">9005</span><span class="o">));</span>
    <span class="n">redisClusterConfiguration</span><span class="o">.</span><span class="na">setClusterNodes</span><span class="o">(</span><span class="n">redisNodes</span><span class="o">);</span>

    <span class="c1">// create lettuce connection factory</span>
    <span class="nc">LettuceConnectionFactory</span> <span class="n">lettuceConnectionFactory</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisClusterConfiguration</span><span class="o">,</span> <span class="n">lettuceClientConfiguration</span><span class="o">);</span>
    <span class="n">lettuceConnectionFactory</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>


    <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="n">simpleRqueueListenerContainerFactory</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">SimpleRqueueListenerContainerFactory</span><span class="o">();</span>
    <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">.</span><span class="na">setRedisConnectionFactory</span><span class="o">(</span><span class="n">lettuceConnectionFactory</span><span class="o">);</span>

    <span class="c1">// set polling interval, by default its 5 seconds</span>
    <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">.</span><span class="na">setPollingInterval</span><span class="o">(</span><span class="nc">Constants</span><span class="o">.</span><span class="na">ONE_MILLI</span><span class="o">);</span>

    <span class="c1">// if reactive redis is enabled set the correct connection factory</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">reactiveEnabled</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">.</span><span class="na">setReactiveRedisConnectionFactory</span><span class="o">(</span>
          <span class="n">lettuceConnectionFactory</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// set any other property if you need</span>

    <span class="c1">// return connection factory</span>
    <span class="k">return</span> <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="redis-sentinel"> <a href="#redis-sentinel" class="anchor-heading" aria-labelledby="redis-sentinel"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis Sentinel</h3>
<p>Redis sentinel can be configured similar to Standalone redis.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisClusterBaseApplication</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="nf">simpleRqueueListenerContainerFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">LettuceClientConfiguration</span> <span class="n">lettuceClientConfiguration</span> <span class="o">=</span>
        <span class="nc">LettuceClientConfiguration</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">readFrom</span><span class="o">(</span><span class="nc">ReadFrom</span><span class="o">.</span><span class="na">MASTER_PREFERRED</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

    <span class="c1">// Sentinel redis configuration, Set fields of redis configuration</span>
    <span class="nc">RedisSentinelConfiguration</span> <span class="n">redisConfiguration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RedisSentinelConfiguration</span><span class="o">();</span>

    <span class="c1">// Create lettuce connection factory</span>
    <span class="nc">LettuceConnectionFactory</span> <span class="n">lettuceConnectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LettuceConnectionFactory</span><span class="o">(</span><span class="n">redisConfiguration</span><span class="o">,</span> <span class="n">lettuceClientConfiguration</span><span class="o">);</span>
    <span class="n">lettuceConnectionFactory</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>

    <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="n">simpleRqueueListenerContainerFactory</span> <span class="o">=</span>
        <span class="k">new</span> <span class="nf">SimpleRqueueListenerContainerFactory</span><span class="o">();</span>
    <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">.</span><span class="na">setRedisConnectionFactory</span><span class="o">(</span><span class="n">lettuceConnectionFactory</span><span class="o">);</span>
    <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">.</span><span class="na">setPollingInterval</span><span class="o">(</span><span class="nc">Constants</span><span class="o">.</span><span class="na">ONE_MILLI</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">reactiveEnabled</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">.</span><span class="na">setReactiveRedisConnectionFactory</span><span class="o">(</span>
          <span class="n">lettuceConnectionFactory</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">simpleRqueueListenerContainerFactory</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h2 id="redis-connection-failure-and-retry"> <a href="#redis-connection-failure-and-retry" class="anchor-heading" aria-labelledby="redis-connection-failure-and-retry"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis connection failure and retry</h2>
<p>To adjust the retry interval for failed Redis commands in Rqueue, you can configure the backoff time to a different value. By default, Rqueue retries failed commands after 5 seconds. You can customize this behavior by setting the backoff time to your desired interval. This ensures that if a Redis command fails, Rqueue will retry the command after the specified backoff period before attempting again.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">class</span> <span class="nc">RqueueConfiguration</span> <span class="o">{</span>

  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="nf">simpleRqueueListenerContainerFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">SimpleRqueueListenerContainerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleRqueueListenerContainerFactory</span><span class="o">();</span>
    <span class="c1">//...</span>
    <span class="c1">// set back off time to 100 milli second</span>
    <span class="n">factory</span><span class="o">.</span><span class="na">setBackOffTime</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">factory</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h2 id="redis-key-configuration"> <a href="#redis-key-configuration" class="anchor-heading" aria-labelledby="redis-key-configuration"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis Key configuration</h2>
<p>Rqueue utilizes multiple Redis data types such as <code class="language-plaintext highlighter-rouge">SET</code>, <code class="language-plaintext highlighter-rouge">ZSET</code>, and <code class="language-plaintext highlighter-rouge">LIST</code>. It’s crucial not to delete or modify any Rqueue-related Redis keys, as a single mistake could result in the inadvertent deletion of all tasks. To mitigate this risk, Rqueue prefixes all of its keys with specific identifiers:</p>
<ul>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.key.prefix</code></strong>: Prefix for every key used by Rqueue.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.cluster.mode</code></strong>: Indicates whether your Redis database operates in cluster mode or not. By default, Rqueue assumes cluster mode. Switching from non-cluster to cluster mode can lead to <code class="language-plaintext highlighter-rouge">Cross Slot</code> errors due to the use of Lua scripts for atomic operations.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.simple.queue.prefix:queue</code></strong>: Prefix used for the simple queue (<code class="language-plaintext highlighter-rouge">LIST</code>). By default, it uses <code class="language-plaintext highlighter-rouge">queue</code>, resulting in keys like <code class="language-plaintext highlighter-rouge">__rq::queue::XYZ</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.scheduled.queue.prefix</code></strong>: Prefix used for the delayed queue (<code class="language-plaintext highlighter-rouge">ZSET</code>). Default configuration uses <code class="language-plaintext highlighter-rouge">d-queue::</code>, resulting in keys like <code class="language-plaintext highlighter-rouge">__rq::d-queue::XYZ</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.scheduled.queue.channel.prefix</code></strong>: Prefix for Redis pub/sub channel used when moving messages from the scheduled queue to the simple queue for processing. Default value is <code class="language-plaintext highlighter-rouge">p-channel</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.processing.queue.name.prefix</code></strong>: Prefix used for the processing queue (<code class="language-plaintext highlighter-rouge">ZSET</code>). By default, it uses <code class="language-plaintext highlighter-rouge">p-queue::</code>, resulting in keys like <code class="language-plaintext highlighter-rouge">__rq::p-queue::XYZ</code>. This queue ensures at-least-once message delivery.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.processing.queue.channel.prefix</code></strong>: Prefix for Redis pub/sub channel used when moving messages from the processing queue back to the origin queue, triggered if a listener stops unexpectedly. Default value is <code class="language-plaintext highlighter-rouge">p-channel</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.queues.key.suffix</code></strong>: Key suffix used for storing all active queues. Default value is <code class="language-plaintext highlighter-rouge">queues</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.lock.key.prefix</code></strong>: Prefix used for locking keys. Default value is <code class="language-plaintext highlighter-rouge">lock::</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.queue.stat.key.prefix</code></strong>: Prefix used for storing queue metrics. Default value is <code class="language-plaintext highlighter-rouge">q-stat</code>.</li>
<li>
<strong><code class="language-plaintext highlighter-rouge">rqueue.queue.config.key.prefix</code></strong>: Prefix used for storing listener configuration. Default value is <code class="language-plaintext highlighter-rouge">q-config</code>.</li>
</ul>
<p>These prefixes help Rqueue manage its interactions with Redis effectively while minimizing the risk of unintended data loss or corruption.</p>
<hr>
<footer><p><a href="#top" id="back-to-top">Back to top</a></p>Copyright © 2019-2024 Sonu Kumar. Distributed by an <a href="https://github.com/sonus21/rqueue/tree/main/LICENSE">Apache 2.0 license.</a> Build on 2024-07-09 04:01<div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/sonus21/rqueue/tree/main/configuration/redis-configuration.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer>
</div>
</div>
<div class="search-overlay"></div>
</div>
<script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
</body>
</html>
